---
title: 小程序的权限
date: 2018-05-08 15:19:40
categories:
    - Frontend
tags:
    - 小程序
---

好久没更了，最近一直在忙着小程序的项目。做了一个名片小程序、一个问卷调查小程序。先来讲讲进入小程序后关于权限授权的问题。
<!-- more -->
&nbsp;

## 1、为什么要用授权
在问卷调查小程序里面，需要获取到用户的昵称和头像，而获取这些信息需要经过用户的授权。
授权API：[`wx.authorize`](https://developers.weixin.qq.com/miniprogram/dev/api/authorize.html)
```javascript
wx.authorize({
  scope: 'scope.userInfo',
  success() {
    // 用户已经同意获取用户信息
    wx.getUserInfo()
  }
})
```
&nbsp;

## 2、那么怎么判断用户是否已经授权了呢？
获取授权状态API：[`wx.getSetting`](https://developers.weixin.qq.com/miniprogram/dev/api/setting.html#wxgetsettingobject)
```javascript
wx.getSetting({
  success: res => {
    if (res.authSetting['scope.userInfo']) {
      //用户已授权获取用户信息
      wx.getUserInfo();
    }
  }
})
```
&nbsp;

## 3、用户拒绝授权，但小程序需要用户授权，怎么再次提示用户去授权呢？
发起再次授权API：[`wx.openSetting`](https://developers.weixin.qq.com/miniprogram/dev/api/setting.html)
```javascript
wx.openSetting({
  success: (res) => {
    if (res.authSetting['scope.userInfo']) {
      // 不容易啊，用户终于同意授权了
      wx.getUserInfo();
    }
  }
});
```
&nbsp;